<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hasil Unduhan - Tiktok Downloader</title>
<meta name="description" content="Unduh video dari TikTok tanpa watermark dengan cepat dan mudah.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root {
    --bg-dark: #1e1a30;
    --card-bg: #2b2540;
    --accent-color: #ffc72c;
    --accent-hover: #ffdf7a;
    --text-light: #f0f0f0;
    --text-muted: #a0a0a0;
    --border-color: #443c5b;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--bg-dark);
    color: var(--text-light);
    margin:0; padding:0; height:100vh; overflow:hidden;
}

.container {
    max-width:900px; width:calc(100% - 40px); max-height:calc(100vh - 40px);
    overflow-y:auto; background-color:var(--card-bg); border-radius:20px; padding:25px;
    box-shadow:0 10px 30px rgba(0,0,0,0.5); text-align:center;
    position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
    opacity:0; animation:fadeIn 0.8s ease-out forwards;
}

@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }

.main-title { font-size:2rem; color:var(--accent-color); margin-bottom:5px; }
.subtitle { font-size:0.9rem; color:var(--text-muted); margin-bottom:25px; }

.btn { padding:12px 20px; border-radius:10px; border:none; font-weight:600; cursor:pointer; margin-bottom:8px; }
.btn-primary { background-color:var(--accent-color); color:#2b2540; text-transform:uppercase; letter-spacing:0.5px; display:inline-flex; align-items:center; gap:5px; }
.btn-primary:hover { background-color:var(--accent-hover); }

.result-section { background-color:#3b3550; padding:20px; border-radius:15px; margin-top:25px; animation:slideIn 0.5s ease-out; }
@keyframes slideIn { from{opacity:0; transform:translateY(15px);} to{opacity:1; transform:translateY(0);} }

.video-info { display:flex; align-items:flex-start; gap:15px; text-align:left; margin-bottom:15px; }
.thumbnail { width:80px; height:80px; border-radius:10px; object-fit:cover; flex-shrink:0; }
.video-details { display:flex; flex-direction:column; justify-content:center; min-width:0; }
.video-title { font-weight:600; margin:0 0 5px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.video-author { font-size:0.85rem; color:var(--text-muted); margin:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

.download-links { display:flex; flex-direction:column; gap:10px; text-align:left; }

.message-section { padding:15px; border-radius:10px; margin-top:20px; background-color:#5b3e40; color:#ff9999; display:none; }
.message-text { margin:0; }

.loading-text { font-size:1rem; color:var(--accent-color); margin-bottom:10px; text-align:center; }
.spinner { border:4px solid var(--border-color); border-top:4px solid var(--accent-color); border-radius:50%; width:30px; height:30px; animation:spin 1s linear infinite; margin:0 auto; }
@keyframes spin { 0% {transform:rotate(0deg);} 100%{transform:rotate(360deg);} }
</style>
</head>
<body>
<div class="container">
<header class="header">
    <h1 class="main-title">Hasil Unduhan Video</h1>
    <p class="subtitle">Pilih opsi unduhan di bawah ini.</p>
</header>

<main class="main-content">
    <div id="resultSection" class="result-section">
        <div class="video-info">
            <img id="videoThumbnail" class="thumbnail" alt="Video thumbnail">
            <div class="video-details">
                <p id="videoTitle" class="video-title"></p>
                <p id="videoAuthor" class="video-author"></p>
            </div>
        </div>
        <div id="downloadLinks" class="download-links"></div>
        <div id="loadingIndicator" style="display:none;">
            <p class="loading-text">Sedang mengunduh...</p>
            <div class="spinner"></div>
        </div>
    </div>
    <div id="messageSection" class="message-section">
        <p id="messageText" class="message-text"></p>
    </div>
</main>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const elements = {
        videoThumbnail: document.getElementById('videoThumbnail'),
        videoTitle: document.getElementById('videoTitle'),
        videoAuthor: document.getElementById('videoAuthor'),
        downloadLinks: document.getElementById('downloadLinks'),
        resultSection: document.getElementById('resultSection'),
        messageSection: document.getElementById('messageSection'),
        messageText: document.getElementById('messageText'),
        loadingIndicator: document.getElementById('loadingIndicator'),
    };

    function safeText(str){ const div=document.createElement('div'); div.textContent=str; return div.innerHTML; }

    function getVideoData() {
        try{
            const dataStr = localStorage.getItem('videoData');
            return dataStr ? JSON.parse(dataStr) : null;
        }catch(e){ console.error(e); return null;}
    }

    function showMessage(msg) {
        if(msg){
            elements.messageText.textContent = msg;
            elements.messageSection.style.display='block';
        } else {
            elements.messageSection.style.display='none';
        }
    }

    const videoData = getVideoData();

    if(videoData && videoData.title){
        // Thumbnail & info
        elements.videoThumbnail.src = videoData.thumbnail || 'placeholder.jpg';
        elements.videoThumbnail.onerror = ()=>{ elements.videoThumbnail.src='placeholder.jpg'; };
        elements.videoTitle.innerHTML = safeText(videoData.title || 'Video Tanpa Judul');
        elements.videoAuthor.innerHTML = safeText(videoData.author.nickname || 'Tidak Diketahui');

        elements.resultSection.style.display='block';

        // Download links
        elements.downloadLinks.innerHTML='';
        if(videoData.links && videoData.links.length){
            videoData.links.forEach(async link=>{
                const a=document.createElement('a');
                a.href=link.url;
                a.className='btn btn-primary download-link';
                a.download=true;
                a.rel='noopener noreferrer';

                let text='Unduh';
                const q = link.quality.toLowerCase();
                if(q==='hd') text='Unduh Video (HD)';
                else if(q==='sd') text='Unduh Video (SD)';
                else if(q==='audio') text='Unduh Audio (MP3)';

                a.textContent=text;

                // Span untuk ukuran file
                const sizeSpan=document.createElement('span');
                sizeSpan.style.fontSize='0.85rem'; sizeSpan.style.marginLeft='8px';
                sizeSpan.textContent='(Loading...)';

                try{
                    const headRes = await fetch(link.url,{method:'HEAD'});
                    const cl = headRes.headers.get('Content-Length');
                    if(cl){
                        const kb=Math.round(cl/1024), mb=(cl/(1024*1024)).toFixed(2);
                        sizeSpan.textContent = mb>=1?`(${mb} MB)`:`(${kb} KB)`;
                    } else sizeSpan.textContent='(Size unknown)';
                }catch(e){ sizeSpan.textContent='(Size unknown)'; }

                a.appendChild(sizeSpan);

                a.addEventListener('click', ()=>{
                    elements.downloadLinks.style.display='none';
                    elements.loadingIndicator.style.display='block';
                });

                elements.downloadLinks.appendChild(a);
            });
        } else elements.downloadLinks.innerHTML='<p class="text-muted">Tidak ada tautan unduhan ditemukan.</p>';

    } else {
        elements.resultSection.style.display='none';
        showMessage('Gagal memuat data video. Silakan kembali ke halaman utama.');
    }
});
</script>
</body>
</html>
