<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hasil Unduhan - TikTok Downloader</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <header>
      <h1 class="main-title">Hasil Unduhan Video</h1>
      <p class="subtitle">Pilih opsi unduhan di bawah ini.</p>
    </header>

    <main>
      <div id="resultSection" class="result-section">
        <div class="video-info">
          <img id="videoThumbnail" class="thumbnail" alt="Video thumbnail" />
          <div class="video-details">
            <p id="videoTitle" class="video-title"></p>
            <p id="videoAuthor" class="video-author"></p>
          </div>
        </div>
        <div id="downloadLinks" class="download-links"></div>
        <div id="loadingIndicator" style="display:none; text-align:center;">
          <p class="loading-text">Sedang mengunduh...</p>
          <div class="spinner"></div>
        </div>
      </div>
      <div id="messageSection" class="message-section" style="display:none;">
        <p id="messageText" class="message-text"></p>
      </div>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const videoData = JSON.parse(localStorage.getItem("downloadResult") || "null");

      const videoThumbnail = document.getElementById("videoThumbnail");
      const videoTitle = document.getElementById("videoTitle");
      const videoAuthor = document.getElementById("videoAuthor");
      const downloadLinks = document.getElementById("downloadLinks");
      const resultSection = document.getElementById("resultSection");
      const messageSection = document.getElementById("messageSection");
      const messageText = document.getElementById("messageText");

      function showMessage(msg, type="error") {
        messageText.textContent = msg;
        messageSection.style.display = "block";
        messageSection.className = `message-section message-${type} show`;
        resultSection.style.display = "none";
      }

      if (!videoData) {
        showMessage("Gagal memuat data video. Silakan kembali ke halaman utama.", "error");
        return;
      }

      // Tampilkan info video
      videoThumbnail.src = videoData.thumbnail || "placeholder.jpg";
      videoTitle.textContent = videoData.title || "Video Tanpa Judul";
      videoAuthor.textContent = videoData.author?.nickname || "Tidak Diketahui";
      resultSection.classList.add("show");

      // Tampilkan link download
      downloadLinks.innerHTML = "";
      if (videoData.links && Array.isArray(videoData.links)) {
        videoData.links.forEach((link) => {
          if (!link.url) return;
          const a = document.createElement("a");
          a.href = link.url;
          a.textContent = link.quality === "HD" ? "Unduh Video (HD)" : 
                          link.quality === "audio" ? "Unduh Audio (MP3)" : "Unduh";
          a.className = "btn btn-primary download-link";
          a.rel = "noopener noreferrer";
          a.download = true;
          downloadLinks.appendChild(a);

          a.addEventListener("click", () => {
            downloadLinks.style.display = "none";
            document.getElementById("loadingIndicator").style.display = "block";
          });
        });
      } else {
        downloadLinks.innerHTML = "<p class='text-muted'>Tidak ada tautan unduhan.</p>";
      }

      // Bersihkan setelah dipakai
      localStorage.removeItem("downloadResult");
    });
  </script>
</body>
</html>
